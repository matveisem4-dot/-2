<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sber SIM Bank - Terminal</title>
    <style>
        body { background: #0b2310; color: #2ecc71; font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { background: #2ecc71; color: #0b2310; padding: 15px; text-align: center; font-weight: bold; font-size: 20px; }
        .terminal { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .line { margin-bottom: 5px; border-left: 2px solid #2ecc71; padding-left: 10px; }
        .input-area { background: #111; padding: 20px; border-top: 2px solid #2ecc71; }
        input { width: 100%; background: #000; border: 1px solid #2ecc71; color: #2ecc71; padding: 12px; font-size: 16px; outline: none; margin-bottom: 10px; box-sizing: border-box; }
        .btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 12px; border: none; cursor: pointer; font-weight: bold; text-transform: uppercase; border-radius: 4px; }
        .btn-confirm { background: #2ecc71; color: #000; }
        .btn-code { background: #e74c3c; color: #fff; }
        .system-msg { color: #888; font-style: italic; }
    </style>
</head>
<body>

<div class="header">üè¶ SBER SIM BANK SYSTEM</div>

<div class="terminal" id="screen">
    <div class="line system-msg">[SYSTEM]: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–∏ —Å Firebase...</div>
    <div class="line">[ATM]: –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã (4400...):</div>
</div>

<div class="input-area">
    <input type="text" id="userInput" placeholder="–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö...">
    <div class="btns">
        <button class="btn-confirm" onclick="handleInput()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <button class="btn-code" onclick="sendCodeToAdmin()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
    </div>
</div>

<script>
    // --- –¢–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ Python-–∫–æ–¥–∞ ---
    const TOKEN = '8225785801:AAEer9ushgGTeFpOvvPJ417EzLAqU_7sr10';
    const FIREBASE = "https://cassa-simulator-4-default-rtdb.firebaseio.com";
    const ADMIN_CHAT_ID = "6348924618"; // –°—é–¥–∞ –ø—Ä–∏–¥–µ—Ç –∫–æ–¥ (–∑–∞–º–µ–Ω–∏ –µ—Å–ª–∏ –¥—Ä—É–≥–æ–π)

    let currentStep = "card";
    let activeCard = null;

    function print(text, type = "atm") {
        const screen = document.getElementById('screen');
        const div = document.createElement('div');
        div.className = 'line';
        div.innerText = `[${type.toUpperCase()}]: ${text}`;
        screen.appendChild(div);
        screen.scrollTop = screen.scrollHeight;
    }

    async function handleInput() {
        const input = document.getElementById('userInput');
        const val = input.value.trim();
        if (!val) return;

        if (currentStep === "card") {
            if (val.startsWith("4400")) {
                print(`–ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã ${val}...`, "system");
                let res = await fetch(`${FIREBASE}/cards/${val}.json`).then(r => r.json());
                if (res) {
                    activeCard = { num: val, ...res };
                    currentStep = "pin";
                    print("‚úÖ –ö–∞—Ä—Ç–∞ –Ω–∞–π–¥–µ–Ω–∞! –í–≤–µ–¥–∏—Ç–µ –ü–ò–ù:");
                } else {
                    print("‚ùå –ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.");
                }
            } else { print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (4400...)"); }
        } 
        
        else if (currentStep === "pin") {
            if (String(activeCard.pin) === val) {
                currentStep = "amount";
                print(`üîì –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω. –ë–∞–ª–∞–Ω—Å: ${activeCard.balance} —Ä—É–±.`);
                print("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:");
            } else { print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ü–ò–ù!"); }
        }

        else if (currentStep === "amount") {
            if (!isNaN(val)) {
                let newBal = parseInt(activeCard.balance) + parseInt(val);
                await fetch(`${FIREBASE}/cards/${activeCard.num}.json`, {
                    method: 'PATCH',
                    body: JSON.stringify({ balance: newBal })
                });
                print(`‚úÖ –£—Å–ø–µ—à–Ω–æ! –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${newBal} —Ä—É–±.`, "bank");
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç –≤ Telegram
                sendToTG(`üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã ${activeCard.num}\n–°—É–º–º–∞: ${val} —Ä—É–±.\n–ò—Ç–æ–≥: ${newBal} —Ä—É–±.`);
                currentStep = "card";
                activeCard = null;
            }
        }
        input.value = '';
    }

    async function sendToTG(text) {
        const url = `https://api.telegram.org/bot${TOKEN}/sendMessage?chat_id=${ADMIN_CHAT_ID}&text=${encodeURIComponent(text)}`;
        fetch(url);
    }

    // –¢–í–û–Ø –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø "–û–¢–ü–†–ê–í–ò–¢–¨ –ö–û–î"
    function sendCodeToAdmin() {
        const codeText = "–ö–õ–ò–ï–ù–¢ –ó–ê–ü–†–û–°–ò–õ –ü–ï–†–ï–î–ê–ß–£ –ö–û–î–ê. –¢–ï–ö–£–©–ê–Ø –ö–ê–†–¢–ê: " + (activeCard ? activeCard.num : "–ù–ï–¢");
        sendToTG(codeText);
        print("üöÄ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É!", "system");
    }
</script>

</body>
</html>
