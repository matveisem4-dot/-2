<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Kiosk Pro - –ü–ö –ö–∞—Å—Å–∞</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; display: flex; height: 100vh; background: #f1f5f9; }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –∫–æ—Ä–∑–∏–Ω—ã */
        .cart-panel { width: 400px; background: white; border-right: 2px solid #e2e8f0; padding: 25px; display: flex; flex-direction: column; }
        .cart-items { flex: 1; overflow-y: auto; margin: 20px 0; }
        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f1f5f9; }
        .total { font-size: 32px; font-weight: 800; color: #1e293b; border-top: 3px solid #3b82f6; padding-top: 15px; }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ */
        .main-zone { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #1e293b; color: white; text-align: center; }
        .id-card { background: #3b82f6; padding: 30px 60px; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); margin: 30px; }
        .id-num { font-size: 80px; font-weight: 900; letter-spacing: 8px; }
        .status-dot { width: 15px; height: 15px; background: #10b981; border-radius: 50%; display: inline-block; margin-right: 10px; }
    </style>
</head>
<body>

<div class="cart-panel">
    <h2 style="color: #3b82f6;">üõí –ö–û–†–ó–ò–ù–ê</h2>
    <div id="cart-list" class="cart-items">
        <p style="color: #94a3b8;">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–∫–∞–Ω–µ—Ä–∞...</p>
    </div>
    <div class="total">–ò–¢–û–ì–û: <span id="total-price">0</span> ‚ÇΩ</div>
    <button style="margin-top: 20px; padding: 20px; background: #10b981; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;" onclick="location.reload()">–û–ü–õ–ê–¢–ò–¢–¨ –ò –í–´–ô–¢–ò</button>
</div>

<div class="main-zone">
    <h1>–ö–ê–°–°–ê –°–ê–ú–û–û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø</h1>
    <p style="font-size: 20px; opacity: 0.8;">–í–≤–µ–¥–∏—Ç–µ —ç—Ç–æ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–¥ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:</p>
    <div class="id-card">
        <div class="id-num" id="kiosk-id">------</div>
    </div>
    <div id="online-status" style="display:none;"><span class="status-dot"></span> –°–ò–ù–•–†–û–ù–ò–ó–ò–†–û–í–ê–ù–û</div>
</div>

<script>
    // –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï FIREBASE
    const firebaseConfig = {
        databaseURL: "https://cassa-simulator-4-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π ID, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è
    const randomId = Math.floor(100000 + Math.random() * 900000).toString();
    document.getElementById('kiosk-id').innerText = randomId;

    // 2. –ë–∞–∑–∞ —Ç–æ–≤–∞—Ä–æ–≤
    const products = [
        { name: "–ß–∏–ø—Å—ã Lays", price: 120, code: "12345678" },
        { name: "–ö–æ–ª–∞ 0.5", price: 90, code: "5449000000996" },
        { name: "–®–æ–∫–æ–ª–∞–¥", price: 75, code: "40006702" }
    ];

    let cart = [];

    // 3. –°–ª—É—à–∞–µ–º Firebase –∏–º–µ–Ω–Ω–æ –ø–æ —ç—Ç–æ–º—É —Å–ª—É—á–∞–π–Ω–æ–º—É ID
    db.ref('kiosk/' + randomId).on('value', (snapshot) => {
        const data = snapshot.val();
        if (data && data.scan) {
            document.getElementById('online-status').style.display = 'block';
            const found = products.find(p => p.code === data.scan);
            
            if (found) {
                cart.push(found);
                updateCart();
                new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play();
            }
            // –°—Ä–∞–∑—É —Å—Ç–∏—Ä–∞–µ–º –∏–∑ –±–∞–∑—ã, —á—Ç–æ–±—ã –∂–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Å–∫–∞–Ω
            db.ref('kiosk/' + randomId).update({ scan: "" });
        }
    });

    function updateCart() {
        const list = document.getElementById('cart-list');
        list.innerHTML = cart.map(p => `<div class="item"><span>${p.name}</span><b>${p.price} ‚ÇΩ</b></div>`).join('');
        document.getElementById('total-price').innerText = cart.reduce((s, p) => s + p.price, 0);
    }
</script>
</body>
</html>
