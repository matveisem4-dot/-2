<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Smart Kiosk Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: #f8fafc; color: #1e293b; height: 100vh; display: flex; overflow: hidden; }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ß–µ–∫ */
        .sidebar { width: 400px; background: white; border-right: 2px solid #e2e8f0; display: flex; flex-direction: column; padding: 30px; z-index: 10; }
        .cart-title { font-size: 24px; font-weight: 800; color: #ef4444; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .cart-items { flex: 1; overflow-y: auto; }
        .item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #f1f5f9; animation: slideIn 0.3s ease; }
        .total-section { border-top: 4px solid #1e293b; padding-top: 20px; margin-top: 20px; }
        .total-price { font-size: 48px; font-weight: 900; color: #1e293b; }

        /* –ü—Ä–∞–≤–∞—è –∑–æ–Ω–∞ - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .main-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f1f5f9; position: relative; }
        .scan-msg { text-align: center; }
        .scan-msg h1 { font-size: 40px; margin-bottom: 10px; color: #334155; }
        .btn-pay { background: #22c55e; color: white; padding: 20px; width: 100%; border: none; border-radius: 15px; font-size: 22px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; }
        .btn-pay:hover { background: #16a34a; transform: translateY(-2px); }

        /* –°–∫—Ä—ã—Ç—ã–π ID –≤ —É–≥–ª—É (–¢–≤–æ–µ –ø–æ–∂–µ–ª–∞–Ω–∏–µ) */
        .kiosk-id-wrapper { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
        .kiosk-id-trigger {
            width: 12px; height: 12px; background: rgba(0, 0, 0, 0.1); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: help;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden; color: transparent; font-weight: bold; font-size: 14px; white-space: nowrap;
        }
        .kiosk-id-trigger:hover {
            width: 120px; height: 40px; border-radius: 20px;
            background: #ffffff; color: #1e293b; box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="cart-title">–¢–µ–∫—É—â–∏–π —á–µ–∫</div>
        <div id="cart-list" class="cart-items">
            <p style="color: #94a3b8; text-align: center; margin-top: 50px;">–û–∂–∏–¥–∞–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...</p>
        </div>
        <div class="total-section">
            <div style="font-size: 14px; color: #64748b; text-transform: uppercase;">–ö –æ–ø–ª–∞—Ç–µ:</div>
            <div class="total-price"><span id="total-val">0</span> ‚ÇΩ</div>
            <button class="btn-pay" onclick="finishOrder()">–û–ü–õ–ê–¢–ò–¢–¨</button>
        </div>
    </div>

    <div class="main-content">
        <div class="scan-msg">
            <div style="font-size: 80px; margin-bottom: 20px;">üì¶</div>
            <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>
            <p style="color: #64748b; font-size: 18px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤</p>
        </div>

        <div class="kiosk-id-wrapper">
            <div class="kiosk-id-trigger" id="display-id">000000</div>
        </div>
    </div>

    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE
        const firebaseConfig = { 
            databaseURL: "https://cassa-simulator-4-default-rtdb.firebaseio.com/" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–õ–£–ß–ê–ô–ù–û–ì–û ID
        const kioskId = Math.floor(100000 + Math.random() * 900000).toString();
        document.getElementById('display-id').innerText = kioskId;

        // –ë–ê–ó–ê –¢–û–í–ê–†–û–í (–ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–∏)
        const products = [
            { name: "–ß–∏–ø—Å—ã Lays", price: 149, code: "123456" },
            { name: "–ö–æ–∫–∞-–ö–æ–ª–∞ 0.5", price: 89, code: "5449000000996" },
            { name: "–®–æ–∫–æ–ª–∞–¥ Alpin", price: 75, code: "40006702" }
        ];

        let cart = [];

        // –°–õ–£–®–ê–ï–ú –°–ö–ê–ù–ï–†
        db.ref('kiosks/' + kioskId + '/lastScan').on('value', (snapshot) => {
            const scannedCode = snapshot.val();
            if (scannedCode) {
                const found = products.find(p => p.code === scannedCode);
                if (found) {
                    cart.push(found);
                    renderCart();
                    new Audio('https://www.soundjay.com/buttons/beep-01a.mp3').play();
                }
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è
                db.ref('kiosks/' + kioskId).update({ lastScan: "" });
            }
        });

        function renderCart() {
            const list = document.getElementById('cart-list');
            if (cart.length === 0) return;
            list.innerHTML = cart.map(item => `
                <div class="item">
                    <span>${item.name}</span>
                    <b>${item.price} ‚ÇΩ</b>
                </div>
            `).join('');
            document.getElementById('total-val').innerText = cart.reduce((sum, i) => sum + i.price, 0);
        }

        function finishOrder() {
            if(cart.length > 0) {
                alert("–ó–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É " + document.getElementById('total-val').innerText + " ‚ÇΩ —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω!");
                location.reload();
            }
        }
    </script>
</body>
</html>
