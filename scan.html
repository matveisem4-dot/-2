<!DOCTYPE html>
<html>
<head>
    <title>NFC PAY SCANNER</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
</head>
<body style="text-align:center; font-family:sans-serif; padding-top:50px;">
    <h1>СКАНЕР ДЛЯ ТЕЛЕФОНА</h1>
    <input type="text" id="k-id" placeholder="Введите ID киоска с экрана">
    <br><br>
    <button id="start-nfc" style="padding:20px; font-size:20px;">ВКЛЮЧИТЬ NFC ОПЛАТУ</button>
    <p id="status">Статус: Ожидание...</p>

    <script>
        const firebaseConfig = { databaseURL: "https://cassa-simulator-4-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        document.getElementById('start-nfc').onclick = async () => {
            const kid = document.getElementById('k-id').value;
            if(!kid) return alert("Сначала введи ID киоска!");

            try {
                const reader = new NDEFReader();
                await reader.scan();
                document.getElementById('status').innerText = "Статус: СКАНИРУЮ... Приложи метку!";

                reader.onreading = event => {
                    const serialNumber = event.serialNumber; // Вот тот самый ID, который телефон называет "пустым"
                    db.ref('kiosks/' + kid).update({ lastScan: serialNumber });
                    document.getElementById('status').innerText = "ОПЛАЧЕНО! ID: " + serialNumber;
                    
                    // Вибрация для реализма
                    if (navigator.vibrate) navigator.vibrate(200);
                };
            } catch (error) {
                alert("Ошибка: " + error + ". Убедись, что открыл сайт через HTTPS.");
            }
        };
    </script>
</body>
</html>
